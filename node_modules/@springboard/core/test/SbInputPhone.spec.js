import chai from 'chai'
import { shallowMount } from '@vue/test-utils'

import { SbInputPhone, SbModal } from '../src/components'

chai.should()
chai.use(require('chai-things'))

describe('SbInputPhone.vue', () => {
  it('Should_getCountryFromListReturnFrenchCountryObject_When_FRCodeIsGiven', () => {
    const wrapper = shallowMount(SbInputPhone)

    const result = wrapper.vm.getCountryFromList('FR')

    result.should.have.property('cca2').equal('FR')
    result.should.have.property('name').which.have.property('common').equal('France')
    result.should.have.deep.property('callingCode').equal([ '33' ])
  })

  it('Should_buildCountryListReturnOnlyCountryWithCallingCodeAndCca2_When_NoFilterGiven', () => {
    const wrapper = shallowMount(SbInputPhone)

    const result = wrapper.vm.buildCountryList()

    result.should.be.an('array')
    result.should.all.have.property('callingCode')
    result.should.all.have.property('cca2')
  })

  it('Should_buildCountryListReturnOnlyOneElement_When_FilterIsGermany', () => {
    const wrapper = shallowMount(SbInputPhone)

    const result = wrapper.vm.buildCountryList('Germany')

    result.should.be.an('array').of.length(1)
    result[0].should.be.an('object').with.deep.property('callingCode').equal([ '49' ])
  })

  it('Should_SelectACountryCloseModal_When_CountrySelectedFromCountryListModal', () => {
    const wrapper = shallowMount(SbInputPhone)

    wrapper.find('.phonefield-country-button').trigger('click')
    wrapper.find(SbModal).find('.phonefield-modal-item').trigger('click')

    const data = wrapper.vm.$data
    data.mutableCountry.should.be.an('object')
    data.mutableCountryCode.should.be.a('string')
    data.showCountryModal.should.be.false

    wrapper.emitted().input.should.exist
  })
})
