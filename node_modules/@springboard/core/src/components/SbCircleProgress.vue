<!--
  Majority of the code come from css-tricks.com, with some adjustments

  @source https://css-tricks.com/building-progress-ring-quickly/#article-header-id-7
-->

<template>
  <div class="sb-circle-progress-container sb-shadow-centered-3">
    <div
      class="sb-circle-progress-background"
      :style="{
        top: `${stroke * 3}px`,
        right: `${stroke * 3}px`,
        bottom: `${stroke * 3}px`,
        left: `${stroke * 3}px`,
        'background-image': imageSource ? `url(${imageSource})` : ''
      }"
    >
      <div
        v-if="!imageSource"
        class="icon icon-add-profile"
      />
    </div>
    <svg
      :height="radius * 2"
      :width="radius * 2"
    >
      <!-- linear-gradient(270deg, #02BE8A 0%, #0082C3 100%); -->
      <defs>
        <linearGradient
          id="sb-gradient"
          x1="0%"
          y1="0%"
          x2="0%"
          y2="100%"
        >
          <stop
            offset="0%"
            stop-color="#02BE8A"
          />
          <stop
            offset="100%"
            stop-color="#0082C3"
          />
        </linearGradient>
      </defs>
      <circle
        class="sb-circle-progress-border"
        x="0"
        y="0"
        :stroke-width="stroke * 3"
        :r="normalizedRadius"
        :cx="radius"
        :cy="radius"
      />
      <circle
        class="sb-circle-progress-cirlce"
        x="0"
        y="0"
        stroke="url(#sb-gradient)"
        :stroke-dasharray="circumference + ' ' + circumference"
        :style="{ strokeDashoffset }"
        :stroke-width="stroke"
        :r="normalizedRadius"
        :cx="radius"
        :cy="radius"
      />
      <svg
        v-if="progress < 100"
        class="sb-circle-progress-indicator"
        :x="radius * 2 - 34"
        :y="14"
      >
        <circle
          r="11"
          cx="13"
          cy="13"
        />
        <text
          x="13"
          y="13"
          dy=".3em"
          text-anchor="middle"
        >
          {{ progress }}%
        </text>
      </svg>
    </svg>
  </div>
</template>

<script>
export default {
  name: 'SbCircleProgress',
  props: {
    /**
     * Circle radius in px
     */
    radius: {
      type: Number,
      required: true
    },
    /**
     * Progress state in percent
     */
    progress: {
      type: Number,
      required: true
    },
    /**
     * Circle stroke in px
     */
    stroke: {
      type: Number,
      default: 3
    },
    /**
     * Image display inside the circle
     */
    imageSource: {
      type: String,
      default: ''
    }
  },
  data () {
    const normalizedRadius = this.radius - this.stroke * 2
    const circumference = normalizedRadius * 2 * Math.PI

    return {
      normalizedRadius,
      circumference
    }
  },
  computed: {
    strokeDashoffset () {
      return this.circumference - this.progress / 100 * this.circumference
    }
  }
}
</script>

<style lang="less" scoped>
  @import "../less/variables";

  .sb-circle-progress-container {
    position: relative;
    display: inline-block;
    border-radius: 50%;

    svg {
      position: relative;

      .sb-circle-progress-border {
        stroke: @sb-white;
        fill: transparent;
      }

      .sb-circle-progress-cirlce {
        stroke-linecap: round;
        fill: transparent;
        transition: stroke-dashoffset 0.35s;
        transform: rotate(-45deg);
        transform-origin: 50% 50%;
      }

      .sb-circle-progress-indicator {
        circle {
          fill: @sb-blue;
          stroke: @sb-white;
          stroke-width: 2px;
        }

        text {
          font-family: 'RobotoCondensed';
          fill: @sb-white;
          font-size: 10px;
        }
      }
    }

    .sb-circle-progress-background {
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      border-radius: 50%;
      color: @sb-grey;
      background: @sb-grey-light;
      background-size: cover;
      font-size: 42px;
    }
  }
</style>
